"use strict";(self["webpackChunkpet"]=self["webpackChunkpet"]||[]).push([[410],{410:function(e,t,a){a.r(t),a.d(t,{default:function(){return h}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"category-wrapper"},[t("el-card",{attrs:{shadow:"always"}},[t("div",{staticClass:"control-btns"},[t("el-button",{staticStyle:{float:"right","margin-right":"10px","background-color":"blue","border-color":"blue"},attrs:{type:"primary",size:"medium"},on:{click:function(t){e.exportVisible=!0}}},[e._v("导出数据")])],1),t("el-form",{ref:"searchForm",staticClass:"search-form",attrs:{inline:!0,model:e.listQuery,"label-width":"90px"}},[t("el-form-item",{attrs:{label:"宠物姓名"}},[t("el-input",{attrs:{placeholder:"请输入宠物姓名"},model:{value:e.listQuery.animalName,callback:function(t){e.$set(e.listQuery,"animalName",t)},expression:"listQuery.animalName"}})],1),t("el-select",{staticStyle:{width:"200px","margin-left":"5px"},attrs:{placeholder:"请选择状态"},model:{value:e.listQuery.status,callback:function(t){e.$set(e.listQuery,"status",t)},expression:"listQuery.status"}},[t("el-option",{attrs:{label:"待确认",value:"待处理"}}),t("el-option",{attrs:{label:"寄养中",value:"寄养中"}}),t("el-option",{attrs:{label:"已领回",value:"已领回"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("查询")])],1),t("el-form-item",[t("el-button",{attrs:{type:"danger"},on:{click:e.onReset}},[e._v("重置")])],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"multipleTable",attrs:{data:e.tableData},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{prop:"userName",label:"用户","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"name",label:"宠物昵称","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"time",label:"寄养时间"}}),t("el-table-column",{attrs:{prop:"days",label:"寄养天数"}}),t("el-table-column",{attrs:{prop:"status",label:"寄养状态"}}),t("el-table-column",{attrs:{prop:"roomName",label:"寄养房间"}}),"USER"!=e.userInfo.role?t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return["已领回"!=a.row.status?t("el-button",{attrs:{plain:"",type:"primary",size:"mini"},on:{click:function(t){return e.handleEdit(a.$index,a.row)}}},[e._v("修改")]):e._e(),"待处理"==a.row.status?t("el-button",{attrs:{plain:"",size:"small",type:"warning"},on:{click:function(t){return e.handleOk(a.$index,a.row)}}},[e._v("去处理")]):e._e(),"已领回"==a.row.status?t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(a.$index,a.row)}}},[e._v("删除")]):e._e(),"寄养中"==a.row.status?t("el-button",{attrs:{plain:"",size:"mini",type:"success"},on:{click:function(t){return e.handleGiveBack(a.$index,a.row)}}},[e._v("领回处理")]):e._e()]}}],null,!1,95934708)}):e._e()],1),t("Pagination",{attrs:{total:e.total,page:e.listQuery.currentPage,limit:e.listQuery.pageSize},on:{"update:page":function(t){return e.$set(e.listQuery,"currentPage",t)},"update:limit":function(t){return e.$set(e.listQuery,"pageSize",t)},pagination:e.fetchData}}),t("el-dialog",{staticClass:"dialog-form",attrs:{title:"修改寄养信息",visible:e.formVisibleEdit,width:"30%","close-on-click-modal":!1,modal:!1},on:{"update:visible":function(t){e.formVisibleEdit=t}}},[t("el-form",{ref:"dialogForm",attrs:{model:e.dialogForm,rules:e.formRules,"label-width":"100px"}},[t("el-form-item",{attrs:{prop:"name",label:"宠物昵称"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.dialogForm.name,callback:function(t){e.$set(e.dialogForm,"name",t)},expression:"dialogForm.name"}})],1),t("el-form-item",{attrs:{prop:"time",label:"寄养时间"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:e.dialogForm.time,callback:function(t){e.$set(e.dialogForm,"time",t)},expression:"dialogForm.time"}})],1),t("el-form-item",{attrs:{prop:"days",label:"寄养天数"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.dialogForm.days,callback:function(t){e.$set(e.dialogForm,"days",e._n(t))},expression:"dialogForm.days"}})],1),"已领回"!=e.dialogForm.status?t("el-form-item",{attrs:{prop:"roomId",label:"选择房间"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择房间"},model:{value:e.dialogForm.roomId,callback:function(t){e.$set(e.dialogForm,"roomId",t)},expression:"dialogForm.roomId"}},e._l(e.roomData,(function(e){return t("el-option",{key:e.id,attrs:{disabled:"使用中"===e.status,label:e.name,value:e.id}})})),1)],1):e._e(),t("div",{staticClass:"footer-item"},[t("el-button",{on:{click:function(t){e.formVisibleEdit=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",disabled:e.isSubmit},on:{click:function(t){return e.handleEditSave("dialogForm")}}},[e._v("确 定")])],1)],1)],1),t("el-dialog",{attrs:{title:"寄养处理",visible:e.roomVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(t){e.roomVisible=t}}},[t("el-form",{staticStyle:{"padding-right":"50px"},attrs:{"label-width":"100px",model:e.dialogForm}},[t("el-form-item",{attrs:{prop:"roomId",label:"选择房间"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择房间"},model:{value:e.dialogForm.roomId,callback:function(t){e.$set(e.dialogForm,"roomId",t)},expression:"dialogForm.roomId"}},e._l(e.roomData,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.roomVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.fosterSave}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"导出数据",visible:e.exportVisible,width:"500px"},on:{"update:visible":function(t){e.exportVisible=t}}},[t("div",{staticClass:"export-data",staticStyle:{display:"flex","flex-direction":"row","justify-content":"space-between"}},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.exportTable("xlsx")}}},[e._v("EXCEL格式")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.exportTable("csv")}}},[e._v("CSV格式")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.exportTable("txt")}}},[e._v("TXT格式")])],1),t("div",{staticClass:"hints"},[e._v("TIP：请选择要导出数据的格式。")])])],1)],1)},i=[],o=a(186),l=a(1184),r=a(1867),n=a(193),m=a(7120),d={inject:["userInfo"],name:"UserManager",components:{Pagination:l.A,Upload:r.A,Hints:n.A},data(){return{uploadUrl:"/api/file/upload",imgBaseUrl:this.HOST,listLoading:!0,roomData:[],listQuery:{animalName:void 0,status:void 0,currentPage:1,pageSize:10},dialogForm:{userId:"",name:"",time:"",days:"",status:"",roomId:""},total:0,tableData:[],multipleSelection:[],roomVisible:!1,formVisibleEdit:!1,categoryList:[],formRules:{name:[{required:!0,message:"请输入房间编号",trigger:"blur"}],time:[{required:!0,message:"请选择寄养时间",trigger:"blur"}],days:[{required:!0,message:"请填写寄养天数",trigger:"blur"},{type:"number",message:"请填写数字",trigger:"blur"}]},isSubmit:!1,filesFormat:".txt, .csv, .xls, .xlsx",exportVisible:!1}},created(){this.fetchData()},methods:{fosterSave(){this.dialogForm.status="寄养中",m.A.put("/foster/"+this.dialogForm.id,this.dialogForm).then((e=>{0==e.code?(this.$message({showClose:!0,message:"分配成功",type:"success"}),this.formVisibleEdit=!1,this.fetchData()):this.$message({showClose:!0,message:e.msg,type:"error"})}))},handleSelectionChange(e){this.multipleSelection=e.map((e=>e.id))},handleGiveBack(e,t){this.dialogForm=JSON.parse(JSON.stringify(t)),this.dialogForm.status="已领回",this.$confirm("确认领回宠物？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{m.A.put("/foster/"+this.dialogForm.id,this.dialogForm).then((e=>{0==e.code?(this.$message({showClose:!0,message:"领回成功",type:"success"}),this.formVisibleEdit=!1,this.fetchData()):this.$message({showClose:!0,message:e.msg,type:"error"})}))})).catch((()=>{this.$message({type:"info",message:"已取消"})}))},handleEdit(e,t){this.loadRooms(),this.dialogForm=JSON.parse(JSON.stringify(t)),this.formVisibleEdit=!0},loadRooms(){m.A.get("/room/selectAll").then((e=>{"0"===e.code?this.roomData=e.data:this.$message.error(e.msg)}))},handleOk(e,t){this.loadRooms(),this.dialogForm=JSON.parse(JSON.stringify(t)),this.roomVisible=!0},handleDelete(e,t){this.$confirm("此操作将删除选中数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{m.A.delete("/foster/"+t.id).then((e=>{0==e.code?(this.$message({type:"success",message:"删除成功!"}),this.onReset()):this.$message({type:"success",error:e.msg})}))})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},batchDelete(){this.multipleSelection.length<1?this.$message({message:"请先选择要删除的数据！",type:"warning"}):m.A.delete(`/foster/deleteBatch?ids=${this.multipleSelection.join(",")}`).then((e=>{"0"===e.code?(this.$message({showClose:!0,message:"批量删除成功",type:"success"}),this.onReset()):this.$message({showClose:!0,message:e.msg,type:"error"})}))},fetchData(){this.listLoading=!0,m.A.get("/foster/selectPage",{params:{userId:"USER"==this.userInfo.role?this.userInfo.id:-1,animalName:this.listQuery.animalName,status:this.listQuery.status,currentPage:this.listQuery.currentPage,size:this.listQuery.pageSize}}).then((e=>{const t=e.data;"0"===e.code&&(this.total=t.total,this.tableData=t.records)})),this.listLoading=!1},onSubmit(){this.listQuery.currentPage=1,this.fetchData()},onReset(){this.listQuery.currentPage=1,this.listQuery.pageSize=10,this.listQuery.animalName="",this.fetchData()},handleEditSave(e){this.$refs[e].validate((e=>{e&&m.A.put("/foster/"+this.dialogForm.id,this.dialogForm).then((e=>{0==e.code?(this.$message({showClose:!0,message:"更新成功",type:"success"}),this.formVisibleEdit=!1,this.fetchData()):this.$message({showClose:!0,message:e.msg,type:"error"})}))}))},exportTable(e){if(this.tableData.length){const t={header:["序号","用户","宠物昵称","寄养时间","寄养天数","寄养状态","寄养房间"],key:["id","userName","name","time","days","status","roomName"],data:this.tableData.map((e=>({id:e.id,userName:e.userName,name:e.name,time:e.time,days:e.days,status:e.status,roomName:e.roomName}))),autoWidth:!0,fileName:"寄养信息表",bookType:e};o.Ay.exportDataToExcel(t),this.exportVisible=!1}}}},c=d,u=a(1656),p=(0,u.A)(c,s,i,!1,null,null,null),h=p.exports}}]);
//# sourceMappingURL=410.dac7b97a.js.map