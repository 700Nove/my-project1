"use strict";(self["webpackChunkpet"]=self["webpackChunkpet"]||[]).push([[48],{48:function(e,t,r){r.r(t),r.d(t,{default:function(){return c}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"user-info",staticStyle:{display:"flex",width:"100%","justify-content":"center"}},[t("el-card",{staticStyle:{width:"40%",margin:"20px"}},[t("div",{staticStyle:{margin:"15px","text-align":"center"}},[t("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.uploadUrl,"show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[e.userInfo.avatar?t("el-image",{staticClass:"avatar",attrs:{src:e.imgBaseUrl+"/"+e.userInfo.avatar}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})],1)],1),t("el-form",{ref:"userInfoForm",attrs:{model:e.userInfo,rules:e.rules,"label-width":"80px"}},[t("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"用户名：",prop:"username"}},[t("el-input",{attrs:{disabled:""},model:{value:e.userInfo.username,callback:function(t){e.$set(e.userInfo,"username",t)},expression:"userInfo.username"}})],1),t("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"姓名：",prop:"name"}},[t("el-input",{model:{value:e.userInfo.name,callback:function(t){e.$set(e.userInfo,"name",t)},expression:"userInfo.name"}})],1),t("el-form-item",{attrs:{label:"性别：",prop:"sex"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.userInfo.sex,callback:function(t){e.$set(e.userInfo,"sex",t)},expression:"userInfo.sex"}},[t("el-option",{attrs:{label:"男",value:"男"}}),t("el-option",{attrs:{label:"女",value:"女"}})],1)],1),t("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"邮箱：",prop:"email"}},[t("el-input",{model:{value:e.userInfo.email,callback:function(t){e.$set(e.userInfo,"email",t)},expression:"userInfo.email"}})],1),t("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"电话：",prop:"phone"}},[t("el-input",{model:{value:e.userInfo.phone,callback:function(t){e.$set(e.userInfo,"phone",t)},expression:"userInfo.phone"}})],1),t("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"角色："}},[t("div",[t("el-tag",{attrs:{type:"success"}},[e._v(e._s(e.getRoleName(e.userInfo.role)))])],1)]),"USER"==e.userInfo.role?t("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"账户余额:"}},[t("div",{staticClass:"balance-container"},[t("span",{staticClass:"balance-amount"},[e._v(e._s(e.userInfo.account||0)+"元")]),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.showRechargeDialog}},[e._v("充值")])],1)]):e._e(),"USER"==e.userInfo.role?t("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"收货地址:",prop:"address"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.userInfo.address,callback:function(t){e.$set(e.userInfo,"address",t)},expression:"userInfo.address"}})],1):e._e(),t("div",{staticStyle:{"text-align":"center"}},[t("el-button",{attrs:{type:"success"},on:{click:e.update}},[e._v("保存")])],1)],1)],1),t("el-dialog",{attrs:{title:"账户充值",visible:e.rechargeDialogVisible,width:"30%",center:""},on:{"update:visible":function(t){e.rechargeDialogVisible=t}}},[t("el-form",{ref:"rechargeForm",attrs:{model:e.rechargeForm,rules:e.rechargeRules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"充值金额:",prop:"amount"}},[t("el-input-number",{staticStyle:{width:"200px"},attrs:{min:10,max:1e4,step:10,"controls-position":"right"},model:{value:e.rechargeForm.amount,callback:function(t){e.$set(e.rechargeForm,"amount",t)},expression:"rechargeForm.amount"}})],1),t("el-form-item",{attrs:{label:"支付方式:"}},[t("el-radio-group",{model:{value:e.rechargeForm.paymentMethod,callback:function(t){e.$set(e.rechargeForm,"paymentMethod",t)},expression:"rechargeForm.paymentMethod"}},[t("el-radio",{attrs:{label:"alipay"}},[e._v("支付宝")]),t("el-radio",{attrs:{label:"wechat"}},[e._v("微信支付")]),t("el-radio",{attrs:{label:"creditCard"}},[e._v("银行卡")])],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.rechargeDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",loading:e.rechargeLoading},on:{click:e.handleRecharge}},[e._v("确认充值")])],1)],1)],1)},s=[],l=r(7120),i={name:"PersonInfo",inject:["userInfo"],created(){},data(){return{imgBaseUrl:this.HOST,uploadUrl:"/api/file/upload",rechargeDialogVisible:!1,rechargeLoading:!1,rechargeForm:{amount:100,paymentMethod:"alipay"},rechargeRules:{amount:[{required:!0,message:"请输入充值金额",trigger:"blur"},{type:"number",min:10,max:1e4,message:"充值金额必须在10-10000之间",trigger:"blur"}]},rules:{name:[{required:!0,message:"姓名不能为空",trigger:"blur"},{min:2,max:10,message:"姓名长度必须在2到10个字符之间",trigger:"blur"}],sex:[{required:!0,message:"性别不能为空",trigger:"change"}],email:[{required:!0,message:"邮箱不能为空",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],phone:[{required:!0,message:"电话不能为空",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}]}}},methods:{showRechargeDialog(){this.rechargeDialogVisible=!0},handleRecharge(){this.$refs.rechargeForm.validate((e=>{e&&(this.rechargeLoading=!0,setTimeout((()=>{const e=(this.userInfo.account||0)+this.rechargeForm.amount;l.A.put("/user/recharge",{userId:this.userInfo.id,amount:this.rechargeForm.amount}).then((t=>{this.rechargeLoading=!1,"0"===t.code?(this.userInfo.account=e,this.$message({type:"success",message:`充值成功，账户余额已增加${this.rechargeForm.amount}元`}),sessionStorage.setItem("user",JSON.stringify(this.userInfo)),this.rechargeDialogVisible=!1):this.$message.error(t.msg||"充值失败，请稍后再试")})).catch((e=>{this.rechargeLoading=!1,console.error("充值请求出错",e),this.$message.error("充值请求失败，请检查网络连接")}))}),1e3))}))},handleAvatarSuccess(e,t){this.userInfo.avatar=e.data},beforeAvatarUpload(e){const t=e.type.match("image/jpeg|image/png"),r=e.size/1024/1024<2;return t||this.$message.error("上传头像图片只能是 JPG 或 PNG 格式!"),r||this.$message.error("上传头像图片大小不能超过 2MB!"),t&&r},getRoleName(e){switch(e){case"ADMIN":return"管理员";case"USER":return"普通用户";case"SUPER_ADMIN":return"超级管理员";default:return"未知角色"}},update(){this.$refs.userInfoForm.validate((e=>{if(!e)return!1;l.A.put("/user/"+this.userInfo.id,this.userInfo).then((e=>{"0"==e.code?(this.$message({type:"success",message:"信息保存成功!"}),sessionStorage.setItem("user",JSON.stringify(this.userInfo)),this.$emit("update:user",this.userInfo)):this.$message({type:"error",message:e.msg})}))}))}}},o=i,n=r(1656),u=(0,n.A)(o,a,s,!1,null,"d5be3e1a",null),c=u.exports}}]);
//# sourceMappingURL=48.f93f0024.js.map