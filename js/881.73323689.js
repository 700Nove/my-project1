"use strict";(self["webpackChunkpet"]=self["webpackChunkpet"]||[]).push([[881],{881:function(e,t,a){a.r(t),a.d(t,{default:function(){return h}});var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"user-manager"},[t("el-card",{staticClass:"main-card",attrs:{shadow:"hover"}},[t("div",{staticClass:"action-bar"},[t("div",{staticClass:"left-actions"},[t("el-popconfirm",{attrs:{title:"确认删除选中用户?"},on:{confirm:e.batchDelete},scopedSlots:e._u([{key:"reference",fn:function(){return[t("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"medium"}},[e._v("批量删除")])]},proxy:!0}])})],1),t("div",{staticClass:"right-actions"},[t("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"medium"},on:{click:e.handleCreate}},[e._v("添加用户")]),t("el-button",{attrs:{type:"success",icon:"el-icon-download",size:"medium"},on:{click:function(t){e.exportVisible=!0}}},[e._v("导出数据")])],1)]),t("el-form",{ref:"searchForm",staticClass:"search-form",attrs:{inline:!0,model:e.listQuery}},[t("el-form-item",{attrs:{label:"用户名"}},[t("el-input",{attrs:{placeholder:"请输入用户名","prefix-icon":"el-icon-user"},model:{value:e.listQuery.username,callback:function(t){e.$set(e.listQuery,"username",t)},expression:"listQuery.username"}})],1),t("el-form-item",{attrs:{label:"姓名"}},[t("el-input",{attrs:{placeholder:"请输入姓名","prefix-icon":"el-icon-s-custom"},model:{value:e.listQuery.name,callback:function(t){e.$set(e.listQuery,"name",t)},expression:"listQuery.name"}})],1),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"SUPER_ADMIN"==e.userInfo.role,expression:"userInfo.role == 'SUPER_ADMIN'"}],attrs:{label:"角色"}},[t("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择角色"},model:{value:e.listQuery.role,callback:function(t){e.$set(e.listQuery,"role",t)},expression:"listQuery.role"}},[t("el-option",{attrs:{label:"管理员",value:"ADMIN"}}),t("el-option",{attrs:{label:"普通用户",value:"USER"}})],1)],1),t("el-form-item",{attrs:{label:"性别"}},[t("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择性别"},model:{value:e.listQuery.sex,callback:function(t){e.$set(e.listQuery,"sex",t)},expression:"listQuery.sex"}},[t("el-option",{attrs:{label:"男",value:"男"}}),t("el-option",{attrs:{label:"女",value:"女"}})],1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.onSubmit}},[e._v("查询")]),t("el-button",{attrs:{icon:"el-icon-refresh"},on:{click:e.onReset}},[e._v("重置")])],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"multipleTable",staticClass:"user-table",attrs:{data:e.tableData,border:"",stripe:""},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),t("el-table-column",{attrs:{prop:"id",label:"编号",width:"80",align:"center",sortable:""}}),t("el-table-column",{attrs:{prop:"username",label:"用户名","min-width":"120"}}),t("el-table-column",{attrs:{prop:"name",label:"姓名","min-width":"100"}}),t("el-table-column",{attrs:{prop:"avatar",label:"头像",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-avatar",{attrs:{size:40,src:e.imgBaseUrl+"/"+a.row.avatar}},[t("img",{attrs:{src:"https://cube.elemecdn.com/e/fd/0fc7d20532fdaf769a25683617711png.png"}})])]}}])}),"SUPER_ADMIN"==e.userInfo.role?t("el-table-column",{attrs:{prop:"role",label:"角色",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:"ADMIN"==a.row.role?"warning":"success",size:"small"}},[e._v(" "+e._s(e.getRoleName(a.row.role))+" ")])]}}],null,!1,2274182883)}):e._e(),t("el-table-column",{attrs:{prop:"sex",label:"性别",width:"80",align:"center"}}),t("el-table-column",{attrs:{prop:"phone",label:"电话","min-width":"120"}}),t("el-table-column",{attrs:{prop:"email",label:"邮箱","min-width":"180"}}),t("el-table-column",{attrs:{prop:"account",label:"余额",width:"100",align:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v("¥"+e._s(Number(a.row.account).toFixed(2)))])]}}])}),t("el-table-column",{attrs:{label:"操作",width:"180",align:"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-edit"},on:{click:function(t){return e.handleEdit(a.$index,a.row)}}},[e._v("编辑")]),"SUPER_ADMIN"!==a.row.role?t("el-button",{staticClass:"delete-btn",attrs:{type:"text",size:"small",icon:"el-icon-delete"},on:{click:function(t){return e.handleDelete(a.$index,a.row)}}},[e._v("删除")]):e._e()]}}])})],1),t("div",{staticClass:"pagination-container"},[t("Pagination",{attrs:{total:e.total,page:e.listQuery.currentPage,limit:e.listQuery.pageSize},on:{"update:page":function(t){return e.$set(e.listQuery,"currentPage",t)},"update:limit":function(t){return e.$set(e.listQuery,"pageSize",t)},pagination:e.fetchData}})],1)],1),t("el-dialog",{staticClass:"user-dialog",attrs:{title:e.dialogTitle,visible:e.dialogVisible,modal:!1,width:"500px","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"dialogForm",staticClass:"dialog-form",attrs:{model:e.dialogForm,rules:e.formRules,"label-width":"80px"}},[e.isEdit?t("div",{staticClass:"avatar-upload"},[t("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.uploadUrl,"show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[e.dialogForm.avatar?t("img",{staticClass:"avatar",attrs:{src:e.imgBaseUrl+"/"+e.dialogForm.avatar}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),t("div",{staticClass:"upload-tip"},[e._v("点击上传头像")])],1):e._e(),t("el-form-item",{attrs:{label:"用户名",prop:"username"}},[t("el-input",{attrs:{placeholder:"请输入用户名"},model:{value:e.dialogForm.username,callback:function(t){e.$set(e.dialogForm,"username",t)},expression:"dialogForm.username"}})],1),"SUPER_ADMIN"==e.userInfo.role?t("el-form-item",{attrs:{label:"角色",prop:"role"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择角色"},model:{value:e.dialogForm.role,callback:function(t){e.$set(e.dialogForm,"role",t)},expression:"dialogForm.role"}},[t("el-option",{attrs:{label:"普通用户",value:"USER"}}),t("el-option",{attrs:{label:"管理员",value:"ADMIN"}})],1)],1):e._e(),t("el-form-item",{attrs:{label:"姓名",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入姓名"},model:{value:e.dialogForm.name,callback:function(t){e.$set(e.dialogForm,"name",t)},expression:"dialogForm.name"}})],1),t("el-form-item",{attrs:{label:"性别",prop:"sex"}},[t("el-radio-group",{model:{value:e.dialogForm.sex,callback:function(t){e.$set(e.dialogForm,"sex",t)},expression:"dialogForm.sex"}},[t("el-radio",{attrs:{label:"男"}},[e._v("男")]),t("el-radio",{attrs:{label:"女"}},[e._v("女")])],1)],1),t("el-form-item",{attrs:{label:"电话",prop:"phone"}},[t("el-input",{attrs:{placeholder:"请输入电话"},model:{value:e.dialogForm.phone,callback:function(t){e.$set(e.dialogForm,"phone",t)},expression:"dialogForm.phone"}})],1),t("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[t("el-input",{attrs:{placeholder:"请输入邮箱"},model:{value:e.dialogForm.email,callback:function(t){e.$set(e.dialogForm,"email",t)},expression:"dialogForm.email"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.closeDialog}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",disabled:e.isSubmit},on:{click:e.handleSubmit}},[e._v("确 定")])],1)],1),t("el-dialog",{staticClass:"export-dialog",attrs:{title:"导出数据",visible:e.exportVisible,width:"500px"},on:{"update:visible":function(t){e.exportVisible=t}}},[t("div",{staticClass:"export-options"},[t("el-button",{attrs:{type:"primary",icon:"el-icon-document"},on:{click:function(t){return e.exportTable("xlsx")}}},[e._v("EXCEL格式")]),t("el-button",{attrs:{type:"success",icon:"el-icon-document"},on:{click:function(t){return e.exportTable("csv")}}},[e._v("CSV格式")]),t("el-button",{attrs:{type:"info",icon:"el-icon-document"},on:{click:function(t){return e.exportTable("txt")}}},[e._v("TXT格式")])],1),t("div",{staticClass:"export-tip"},[e._v("请选择要导出数据的格式")])])],1)},s=[],i=a(186),o=a(1184),r=a(1867),n=a(193),c=a(7120),u={inject:["userInfo"],name:"UserManager",components:{Pagination:o.A,Upload:r.A,Hints:n.A},data(){return{uploadUrl:"/api/file/upload",imgBaseUrl:this.HOST,listLoading:!0,listQuery:{name:void 0,username:void 0,sex:void 0,role:void 0,currentPage:1,pageSize:10},dialogForm:{id:void 0,username:void 0,password:void 0,name:void 0,avatar:void 0,role:void 0,sex:void 0,phone:void 0,email:void 0},total:0,tableData:[],multipleSelection:[],dialogVisible:!1,isEdit:!1,categoryList:[],formRules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}],sex:[{required:!0,message:"请选择性别",trigger:"change"}],phone:[{validator:this.validatePhone,trigger:"blur"}],email:[{type:"email",message:"请输入有效的邮箱地址",trigger:["blur","change"]}]},isSubmit:!1,filesFormat:".txt, .csv, .xls, .xlsx",exportVisible:!1}},computed:{dialogTitle(){return this.isEdit?"修改用户信息":"添加用户"}},created(){this.fetchData()},methods:{handleAvatarSuccess(e,t){this.dialogForm.avatar=e.data},beforeAvatarUpload(e){const t=e.type.match("image/jpeg|image/png"),a=e.size/1024/1024<2;return t||this.$message.error("上传头像图片只能是 JPG 或 PNG 格式!"),a||this.$message.error("上传头像图片大小不能超过 2MB!"),t&&a},onUploadSuccess(e){this.dialogForm.img=e.data},getCompleteImgUrl(e){return this.HOST+e},handleSelectionChange(e){this.multipleSelection=e.map((e=>e.id))},handleCreate(){this.isEdit=!1,this.dialogForm={},this.dialogVisible=!0},getRoleName(e){switch(e){case"USER":return"普通用户";case"ADMIN":return"管理员";default:return"未知"}},handleEdit(e,t){this.isEdit=!0,this.dialogForm=JSON.parse(JSON.stringify(t)),this.dialogVisible=!0},closeDialog(){this.dialogVisible=!1,this.dialogForm={}},handleSubmit(){this.isEdit?this.handleEditSave("dialogForm"):this.handleAdd("dialogForm")},handleAdd(e){this.$refs[e].validate((e=>e?(c.A.post("/user",this.dialogForm).then((e=>{0==e.code?(this.$message({showClose:!0,message:"用户添加成功，默认密码为"+e.data.password,type:"success"}),this.fetchData()):this.$message({showClose:!0,message:e.msg,type:"error"})})),this.closeDialog(),!0):(this.isSubmit=!1,!1)))},handleDelete(e,t){this.$confirm("此操作将删除选中数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{c.A.delete("/user/"+t.id).then((e=>{0==e.code?(this.$message({type:"success",message:"删除成功!"}),this.onReset()):this.$message({type:"success",error:"删除失败!"})}))})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},batchDelete(){this.multipleSelection.length<1?this.$message({message:"请先选择要删除的数据！",type:"warning"}):c.A.delete(`/user/deleteBatch?ids=${this.multipleSelection.join(",")}`).then((e=>{"0"===e.code?(this.$message({showClose:!0,message:"批量删除成功",type:"success"}),this.onReset()):this.$message({showClose:!0,message:e.msg,type:"error"})}))},fetchData(){this.listLoading=!0,c.A.get("/user/page",{params:{username:this.listQuery.username,name:this.listQuery.name,sex:this.listQuery.sex,role:this.listQuery.role,currentRole:this.userInfo.role,currentPage:this.listQuery.currentPage,size:this.listQuery.pageSize}}).then((e=>{const t=e.data;"0"===e.code&&(this.total=t.total,this.tableData=t.records)})),this.listLoading=!1},onSubmit(){this.listQuery.currentPage=1,this.fetchData()},onReset(){this.listQuery.currentPage=1,this.listQuery.pageSize=10,this.listQuery.name="",this.listQuery.username="",this.listQuery.sex="",this.listQuery.role="",this.fetchData()},handleEditSave(e){this.$refs[e].validate((e=>{e&&c.A.put("/user/"+this.dialogForm.id,this.dialogForm).then((e=>{0==e.code?(this.$message({showClose:!0,message:"更新成功",type:"success"}),this.closeDialog(),this.fetchData()):this.$message({showClose:!0,message:"更新失败",type:"error"})}))}))},exportTable(e){if(this.tableData.length){const t={header:["编号","用户名","姓名","头像","角色","性别","电话","邮箱"],key:["id","username","name","avatar","role","sex","phone","email"],data:this.tableData,autoWidth:!0,fileName:"用户数据表",bookType:e};i.Ay.exportDataToExcel(t),this.exportVisible=!1}}}},d=u,m=a(1656),p=(0,m.A)(d,l,s,!1,null,null,null),h=p.exports}}]);
//# sourceMappingURL=881.73323689.js.map