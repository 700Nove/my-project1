"use strict";(self["webpackChunkpet"]=self["webpackChunkpet"]||[]).push([[120],{2120:function(e,t,i){i.r(t),i.d(t,{default:function(){return h}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"category-wrapper"},[t("el-card",{attrs:{shadow:"always"}},[t("div",{staticClass:"control-btns"},[t("el-popconfirm",{attrs:{title:"确认删除?"},on:{confirm:e.batchDelete},scopedSlots:e._u([{key:"reference",fn:function(){return[t("el-button",{staticStyle:{"background-color":"red","border-color":"red"},attrs:{type:"danger",size:"medium"}},[e._v("批量删除")])]},proxy:!0}])}),t("el-button",{staticStyle:{float:"right","margin-right":"10px","background-color":"blue","border-color":"blue"},attrs:{type:"primary",size:"medium"},on:{click:function(t){e.exportVisible=!0}}},[e._v("导出数据")])],1),t("el-form",{ref:"searchForm",staticClass:"search-form",attrs:{inline:!0,model:e.listQuery,"label-width":"90px"}},[t("el-form-item",{attrs:{label:"宠物名字"}},[t("el-input",{attrs:{placeholder:"请输入宠物名字"},model:{value:e.listQuery.name,callback:function(t){e.$set(e.listQuery,"name",t)},expression:"listQuery.name"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("查询")])],1),t("el-form-item",[t("el-button",{attrs:{type:"danger"},on:{click:e.onReset}},[e._v("重置")])],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"multipleTable",attrs:{data:e.tableData},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),t("el-table-column",{attrs:{prop:"id",label:"序号",width:"80",align:"center",sortable:""}}),t("el-table-column",{attrs:{prop:"animalImg",label:"宠物头像",width:"100"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-image",{staticStyle:{height:"50px",width:"50px","border-radius":"5px"},attrs:{src:e.imgBaseUrl+"/"+i.row.animalImg,alt:"宠物头像",width:"100","preview-src-list":[e.imgBaseUrl+"/"+i.row.animalImg]}})]}}])}),t("el-table-column",{attrs:{prop:"animalName",label:"宠物姓名","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"userName",label:"领养人","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"time",label:"领养时间"}}),t("el-table-column",{attrs:{prop:"status",label:"领养状态"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-tag",{attrs:{type:e.getStatusType(i.row.status)}},[e._v(e._s(i.row.status))])]}}])}),t("el-table-column",{attrs:{prop:"reviewComment",label:"审核意见","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"reviewTime",label:"审核时间","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(i){return["审核中"!==i.row.status||"SUPER_ADMIN"!==e.userInfo.role&&"ADMIN"!==e.userInfo.role?e._e():t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.handleReview(i.row)}}},[e._v("审核")]),"SUPER_ADMIN"===i.row.role||"ADMIN"===i.row.role?t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(i.$index,i.row)}}},[e._v("删除")]):e._e()]}}])})],1),t("Pagination",{attrs:{total:e.total,page:e.listQuery.currentPage,limit:e.listQuery.pageSize},on:{"update:page":function(t){return e.$set(e.listQuery,"currentPage",t)},"update:limit":function(t){return e.$set(e.listQuery,"pageSize",t)},pagination:e.fetchData}}),t("el-dialog",{attrs:{title:"审核领养申请",visible:e.reviewFormVisible,width:"40%",modal:!1},on:{"update:visible":function(t){e.reviewFormVisible=t}}},[t("el-form",{ref:"reviewForm",staticClass:"dialog-form",attrs:{model:e.reviewForm,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"宠物姓名"}},[t("el-input",{attrs:{disabled:""},model:{value:e.reviewForm.animalName,callback:function(t){e.$set(e.reviewForm,"animalName",t)},expression:"reviewForm.animalName"}})],1),t("el-form-item",{attrs:{label:"领养人"}},[t("el-input",{attrs:{disabled:""},model:{value:e.reviewForm.userName,callback:function(t){e.$set(e.reviewForm,"userName",t)},expression:"reviewForm.userName"}})],1),t("el-form-item",{attrs:{label:"领养时间"}},[t("el-input",{attrs:{disabled:""},model:{value:e.reviewForm.time,callback:function(t){e.$set(e.reviewForm,"time",t)},expression:"reviewForm.time"}})],1),t("el-form-item",{attrs:{label:"审核结果"}},[t("el-radio-group",{model:{value:e.reviewForm.status,callback:function(t){e.$set(e.reviewForm,"status",t)},expression:"reviewForm.status"}},[t("el-radio",{attrs:{label:"领养中"}},[e._v("通过")]),t("el-radio",{attrs:{label:"审核不通过"}},[e._v("不通过")])],1)],1),t("el-form-item",{attrs:{label:"审核意见"}},[t("el-input",{attrs:{type:"textarea",rows:"3",placeholder:"请输入审核意见"},model:{value:e.reviewForm.reviewComment,callback:function(t){e.$set(e.reviewForm,"reviewComment",t)},expression:"reviewForm.reviewComment"}})],1),t("el-form-item",{staticClass:"footer-item"},[t("el-button",{on:{click:function(t){e.reviewFormVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitReview}},[e._v("确定")])],1)],1)],1),t("el-dialog",{attrs:{title:"导出数据",visible:e.exportVisible,width:"500px"},on:{"update:visible":function(t){e.exportVisible=t}}},[t("div",{staticClass:"export-data",staticStyle:{display:"flex","flex-direction":"row","justify-content":"space-between"}},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.exportTable("xlsx")}}},[e._v("EXCEL格式")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.exportTable("csv")}}},[e._v("CSV格式")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.exportTable("txt")}}},[e._v("TXT格式")])],1),t("div",{staticClass:"hints"},[e._v("TIP：请选择要导出数据的格式。")])])],1)],1)},r=[],l=i(186),s=i(1184),o=i(1867),n=i(193),m=i(7120),u={inject:["userInfo"],name:"Animal",components:{Pagination:s.A,Upload:o.A,Hints:n.A},data(){return{uploadUrl:"/api/file/upload",imgBaseUrl:this.HOST,listLoading:!0,listQuery:{name:void 0,currentPage:1,pageSize:10},total:0,tableData:[],multipleSelection:[],reviewFormVisible:!1,reviewForm:{id:null,animalName:"",userName:"",time:"",status:"领养中",reviewComment:"",reviewerId:null},isSubmit:!1,filesFormat:".txt, .csv, .xls, .xlsx",exportVisible:!1}},created(){this.fetchData()},methods:{getStatusType(e){const t={"领养中":"success","待领养":"info","审核中":"warning","审核不通过":"danger"};return t[e]||"info"},handleReview(e){this.reviewForm={id:e.id,animalName:e.animalName,userName:e.userName,time:e.time,status:"领养中",reviewComment:"",reviewerId:this.userInfo.id},this.reviewFormVisible=!0},submitReview(){this.reviewForm.reviewComment?m.A.put(`/adopt/review/${this.reviewForm.id}`,this.reviewForm).then((e=>{0==e.code?(this.$message({showClose:!0,message:"审核成功",type:"success"}),this.reviewFormVisible=!1,this.fetchData()):this.$message({showClose:!0,message:e.msg||"审核失败",type:"error"})})).catch((e=>{console.error(e),this.$message({showClose:!0,message:"审核失败，请稍后重试",type:"error"})})):this.$message.warning("请填写审核意见")},handleSelectionChange(e){this.multipleSelection=e.map((e=>e.id))},handleDelete(e,t){this.$confirm("此操作将删除选中数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{m.A.delete("/adopt/"+t.id).then((e=>{0==e.code?(this.$message({type:"success",message:"删除成功!"}),this.onReset()):this.$message({type:"error",message:"删除失败!"})}))})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},batchDelete(){this.multipleSelection.length<1?this.$message({message:"请先选择要删除的数据！",type:"warning"}):m.A.delete(`/adopt/deleteBatch?ids=${this.multipleSelection.join(",")}`).then((e=>{"0"===e.code?(this.$message({showClose:!0,message:"批量删除成功",type:"success"}),this.onReset()):this.$message({showClose:!0,message:e.msg,type:"error"})}))},fetchData(){this.listLoading=!0,m.A.get("/adopt/selectPage",{params:{name:this.listQuery.name,currentPage:this.listQuery.currentPage,size:this.listQuery.pageSize}}).then((e=>{const t=e.data;"0"===e.code&&(this.total=t.total,this.tableData=t.records)})),this.listLoading=!1},onSubmit(){this.listQuery.currentPage=1,this.fetchData()},onReset(){this.listQuery.currentPage=1,this.listQuery.pageSize=10,this.listQuery.name="",this.fetchData()},exportTable(e){if(this.tableData.length){const t={header:["序号","宠物头像","宠物姓名","领养人","领养时间","领养状态","审核意见","审核时间"],key:["id","animalImg","animalName","userName","time","status","reviewComment","reviewTime"],data:this.tableData.map((e=>({id:e.id,animalImg:e.animalImg,animalName:e.animalName,userName:e.userName,time:e.time,status:e.status,reviewComment:e.reviewComment||"无",reviewTime:e.reviewTime||"无"}))),autoWidth:!0,fileName:"宠物领养数据表",bookType:e};l.Ay.exportDataToExcel(t),this.exportVisible=!1}}}},c=u,p=i(1656),d=(0,p.A)(c,a,r,!1,null,null,null),h=d.exports}}]);
//# sourceMappingURL=120.5643c2ee.js.map