"use strict";(self["webpackChunkpet"]=self["webpackChunkpet"]||[]).push([[589],{589:function(e,t,a){a.r(t),a.d(t,{default:function(){return p}});var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"animal-manager"},[t("el-card",{staticClass:"main-card",attrs:{shadow:"hover"}},[t("div",{staticClass:"action-bar"},[t("div",{staticClass:"left-actions"},[t("el-popconfirm",{attrs:{title:"确认删除选中宠物?"},on:{confirm:e.batchDelete},scopedSlots:e._u([{key:"reference",fn:function(){return[t("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"medium"}},[e._v("批量删除")])]},proxy:!0}])})],1),t("div",{staticClass:"right-actions"},["USER"!=e.userInfo.role?t("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"medium"},on:{click:e.handleCreate}},[e._v("添加宠物")]):e._e(),"USER"!=e.userInfo.role?t("el-button",{attrs:{type:"success",icon:"el-icon-download",size:"medium"},on:{click:function(t){e.exportVisible=!0}}},[e._v("导出数据")]):e._e()],1)]),t("el-form",{ref:"searchForm",staticClass:"search-form",attrs:{inline:!0,model:e.listQuery}},[t("el-form-item",{attrs:{label:"宠物名字"}},[t("el-input",{attrs:{placeholder:"请输入宠物名字","prefix-icon":"el-icon-search"},model:{value:e.listQuery.name,callback:function(t){e.$set(e.listQuery,"name",t)},expression:"listQuery.name"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.onSubmit}},[e._v("查询")]),t("el-button",{attrs:{icon:"el-icon-refresh"},on:{click:e.onReset}},[e._v("重置")])],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"multipleTable",staticClass:"animal-table",attrs:{data:e.tableData,border:"",stripe:""},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),t("el-table-column",{attrs:{prop:"img",label:"宠物头像",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-image",{staticStyle:{height:"50px",width:"50px","border-radius":"5px"},attrs:{src:e.imgBaseUrl+"/"+a.row.img,alt:"宠物头像","preview-src-list":[e.imgBaseUrl+"/"+a.row.img]}})]}}])}),t("el-table-column",{attrs:{prop:"name",label:"宠物名字","min-width":"120"}}),t("el-table-column",{attrs:{prop:"type",label:"宠物种类","min-width":"100"}}),t("el-table-column",{attrs:{prop:"sex",label:"宠物性别",width:"80",align:"center"}}),t("el-table-column",{attrs:{prop:"age",label:"宠物年龄",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.age)+"岁 ")]}}])}),t("el-table-column",{attrs:{prop:"status",label:"宠物状态",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:"待领养"===a.row.status?"warning":"success",size:"small"}},[e._v(" "+e._s(a.row.status)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"breed",label:"宠物品种","min-width":"120"}}),t("el-table-column",{attrs:{prop:"registrationDate",label:"注册日期",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.registrationDate)+" ")]}}])}),t("el-table-column",{attrs:{prop:"behaviorTraits",label:"行为特征","min-width":"120"}}),t("el-table-column",{attrs:{prop:"sterilizationStatus",label:"绝育状况",width:"100",align:"center"}}),t("el-table-column",{attrs:{prop:"color",label:"颜色",width:"100",align:"center"}}),t("el-table-column",{attrs:{prop:"trainingLevel",label:"训练状况",width:"100",align:"center"}}),t("el-table-column",{attrs:{prop:"specialNeeds",label:"特殊要求","min-width":"120"}}),t("el-table-column",{attrs:{prop:"descr",label:"宠物介绍","min-width":"200","show-overflow-tooltip":""}}),"USER"!=e.userInfo.role?t("el-table-column",{attrs:{label:"操作",width:"180",align:"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-edit"},on:{click:function(t){return e.handleEdit(a.$index,a.row)}}},[e._v("编辑")]),t("el-button",{staticClass:"delete-btn",attrs:{type:"text",size:"small",icon:"el-icon-delete"},on:{click:function(t){return e.handleDelete(a.$index,a.row)}}},[e._v("删除")])]}}],null,!1,994542267)}):e._e()],1),t("div",{staticClass:"pagination-container"},[t("Pagination",{attrs:{total:e.total,page:e.listQuery.currentPage,limit:e.listQuery.pageSize},on:{pagination:e.fetchData}})],1)],1),t("el-dialog",{staticClass:"animal-dialog",attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"500px","close-on-click-modal":!1,modal:!1},on:{"update:visible":function(t){e.dialogVisible=t}},scopedSlots:e._u([{key:"footer",fn:function(){return[t("div",{staticClass:"dialog-footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",disabled:e.isSubmit},on:{click:function(t){e.isEdit?e.handleEditSave("dialogForm"):e.handleAdd("dialogForm")}}},[e._v("确 定")])],1)]},proxy:!0}])},[t("el-form",{ref:"dialogForm",staticClass:"dialog-form",attrs:{model:e.dialogForm,rules:e.formRules,"label-width":"100px"}},[t("div",{staticClass:"avatar-upload"},[t("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.uploadUrl,"show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[e.dialogForm.img?t("img",{staticClass:"avatar",attrs:{src:e.imgBaseUrl+"/"+e.dialogForm.img}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),t("div",{staticClass:"upload-tip"},[e._v("点击上传宠物头像")])],1),t("el-form-item",{attrs:{prop:"name",label:"宠物名字"}},[t("el-input",{attrs:{placeholder:"请输入宠物名字"},model:{value:e.dialogForm.name,callback:function(t){e.$set(e.dialogForm,"name",t)},expression:"dialogForm.name"}})],1),t("el-form-item",{attrs:{prop:"sex",label:"宠物性别"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择性别"},model:{value:e.dialogForm.sex,callback:function(t){e.$set(e.dialogForm,"sex",t)},expression:"dialogForm.sex"}},[t("el-option",{attrs:{label:"公",value:"公"}}),t("el-option",{attrs:{label:"母",value:"母"}})],1)],1),t("el-form-item",{attrs:{prop:"age",label:"宠物年龄"}},[t("el-input",{attrs:{placeholder:"请输入年龄"},model:{value:e.dialogForm.age,callback:function(t){e.$set(e.dialogForm,"age",e._n(t))},expression:"dialogForm.age"}})],1),t("el-form-item",{attrs:{prop:"type",label:"宠物种类"}},[t("el-input",{attrs:{placeholder:"请输入宠物种类"},model:{value:e.dialogForm.type,callback:function(t){e.$set(e.dialogForm,"type",t)},expression:"dialogForm.type"}})],1),t("el-form-item",{attrs:{prop:"status",label:"宠物状态"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择状态"},model:{value:e.dialogForm.status,callback:function(t){e.$set(e.dialogForm,"status",t)},expression:"dialogForm.status"}},[t("el-option",{attrs:{label:"待领养",value:"待领养"}}),t("el-option",{attrs:{label:"已领养",value:"已领养"}})],1)],1),t("el-form-item",{attrs:{prop:"breed",label:"宠物品种"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择品种"},model:{value:e.dialogForm.breed,callback:function(t){e.$set(e.dialogForm,"breed",t)},expression:"dialogForm.breed"}},e._l(e.breedList,(function(e){return t("el-option",{key:e.breedId,attrs:{label:e.breedName,value:e.breedName}})})),1)],1),t("el-form-item",{attrs:{prop:"descr",label:"宠物介绍"}},[t("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入宠物介绍"},model:{value:e.dialogForm.descr,callback:function(t){e.$set(e.dialogForm,"descr",t)},expression:"dialogForm.descr"}})],1),t("el-form-item",{attrs:{prop:"registrationDate",label:"注册日期"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期"},model:{value:e.dialogForm.registrationDate,callback:function(t){e.$set(e.dialogForm,"registrationDate",t)},expression:"dialogForm.registrationDate"}})],1),t("el-form-item",{attrs:{prop:"behaviorTraits",label:"行为特征"}},[t("el-input",{attrs:{placeholder:"请输入行为特征"},model:{value:e.dialogForm.behaviorTraits,callback:function(t){e.$set(e.dialogForm,"behaviorTraits",t)},expression:"dialogForm.behaviorTraits"}})],1),t("el-form-item",{attrs:{prop:"sterilizationStatus",label:"绝育状况"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择绝育状况"},model:{value:e.dialogForm.sterilizationStatus,callback:function(t){e.$set(e.dialogForm,"sterilizationStatus",t)},expression:"dialogForm.sterilizationStatus"}},[t("el-option",{attrs:{label:"无需绝育",value:"无需绝育"}}),t("el-option",{attrs:{label:"已绝育",value:"已绝育"}}),t("el-option",{attrs:{label:"未绝育",value:"未绝育"}})],1)],1),t("el-form-item",{attrs:{prop:"color",label:"颜色"}},[t("el-input",{attrs:{placeholder:"请输入颜色"},model:{value:e.dialogForm.color,callback:function(t){e.$set(e.dialogForm,"color",t)},expression:"dialogForm.color"}})],1),t("el-form-item",{attrs:{prop:"trainingLevel",label:"训练状况"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择训练状况"},model:{value:e.dialogForm.trainingLevel,callback:function(t){e.$set(e.dialogForm,"trainingLevel",t)},expression:"dialogForm.trainingLevel"}},[t("el-option",{attrs:{label:"未知",value:"未知"}}),t("el-option",{attrs:{label:"未训练",value:"未训练"}}),t("el-option",{attrs:{label:"基础训练",value:"基础训练"}}),t("el-option",{attrs:{label:"终极训练",value:"终极训练"}}),t("el-option",{attrs:{label:"高级训练",value:"高级训练"}}),t("el-option",{attrs:{label:"专业训练",value:"专业训练"}})],1)],1),t("el-form-item",{attrs:{prop:"specialNeeds",label:"特殊要求"}},[t("el-input",{attrs:{placeholder:"请输入特殊要求"},model:{value:e.dialogForm.specialNeeds,callback:function(t){e.$set(e.dialogForm,"specialNeeds",t)},expression:"dialogForm.specialNeeds"}})],1)],1)],1),t("el-dialog",{staticClass:"export-dialog",attrs:{title:"导出数据",visible:e.exportVisible,width:"500px"},on:{"update:visible":function(t){e.exportVisible=t}}},[t("div",{staticClass:"export-options"},[t("el-button",{attrs:{type:"primary",icon:"el-icon-document"},on:{click:function(t){return e.exportTable("xlsx")}}},[e._v("EXCEL格式")]),t("el-button",{attrs:{type:"success",icon:"el-icon-document"},on:{click:function(t){return e.exportTable("csv")}}},[e._v("CSV格式")]),t("el-button",{attrs:{type:"info",icon:"el-icon-document"},on:{click:function(t){return e.exportTable("txt")}}},[e._v("TXT格式")])],1),t("div",{staticClass:"export-tip"},[e._v("请选择要导出数据的格式")])])],1)},i=[],s=a(186),r=a(1184),o=a(1867),n=a(193),c=a(7120),d={inject:["userInfo"],name:"Animal",components:{Pagination:r.A,Upload:o.A,Hints:n.A},data(){return{uploadUrl:"/api/file/upload",imgBaseUrl:this.HOST,listLoading:!0,listQuery:{name:void 0,currentPage:1,pageSize:10},dialogForm:{name:"",sex:"",age:"",type:"",breed:"",status:"",registrationDate:"",behaviorTraits:"",sterilizationStatus:"",color:"",trainingLevel:"",specialNeeds:"",descr:""},total:0,tableData:[],breedList:[],multipleSelection:[],dialogVisible:!1,isEdit:!1,categoryList:[],formRules:{name:[{required:!0,message:"宠物名字不能为空",trigger:"blur"},{min:1,max:255,message:"宠物名字长度必须在1到255个字符之间",trigger:"blur"}],sex:[{required:!0,message:"请选择宠物性别",trigger:"change"}],age:[{required:!0,message:"宠物年龄不能为空",trigger:"blur"},{type:"number",message:"宠物年龄必须为数字",trigger:"blur"}],type:[{required:!0,message:"宠物种类不能为空",trigger:"blur"},{min:1,max:255,message:"宠物种类长度必须在1到255个字符之间",trigger:"blur"}],breed:[{required:!0,message:"请选择宠物品种",trigger:"change"}],descr:[{required:!0,message:"宠物介绍不能为空",trigger:"blur"},{min:1,max:255,message:"宠物介绍长度必须在1到255个字符之间",trigger:"blur"}],registrationDate:[{required:!0,message:"请选择注册日期",trigger:"change"},{validator:(e,t,a)=>{const l=new Date;t>l?a(new Error("注册日期不得大于今天")):a()},trigger:"change"}],behaviorTraits:[{required:!0,message:"请输入行为特征",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],sterilizationStatus:[{required:!0,message:"请选择绝育状况",trigger:"change"}],color:[{required:!0,message:"请输入颜色",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],trainingLevel:[{required:!0,message:"请选择训练状况",trigger:"change"}],specialNeeds:[{required:!0,message:"请输入特殊要求",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}]},isSubmit:!1,filesFormat:".txt, .csv, .xls, .xlsx",exportVisible:!1}},computed:{dialogTitle(){return this.isEdit?"修改宠物信息":"添加宠物"}},created(){this.fetchData()},methods:{handleAvatarSuccess(e,t){this.dialogForm.img=e.data},beforeAvatarUpload(e){const t=e.type.match("image/jpeg|image/png"),a=e.size/1024/1024<2;return t||this.$message.error("上传头像图片只能是 JPG 或 PNG 格式!"),a||this.$message.error("上传头像图片大小不能超过 2MB!"),t&&a},onUploadSuccess(e){this.dialogForm.img=e.data},getCompleteImgUrl(e){return this.HOST+e},handleSelectionChange(e){this.multipleSelection=e.map((e=>e.id))},handleCreate(){console.log("handleCreate called"),this.loadBreed(),this.isEdit=!1,this.dialogForm={name:"",sex:"",age:"",type:"",breed:"",status:"待领养",registrationDate:new Date,behaviorTraits:"",sterilizationStatus:"",color:"",trainingLevel:"",specialNeeds:"",descr:""},this.dialogVisible=!0,console.log("dialogVisible set to true:",this.dialogVisible)},handleEdit(e,t){console.log("handleEdit called with row:",t),this.loadBreed(),this.isEdit=!0,this.dialogForm=JSON.parse(JSON.stringify(t)),this.dialogVisible=!0,console.log("dialogVisible set to true:",this.dialogVisible)},loadBreed(){c.A.get("/breed/selectAll").then((e=>{0==e.code?this.breedList=e.data:this.$message({showClose:!0,message:e.msg,type:"error"})}))},handleAdd(e){this.$refs[e].validate((e=>e?(this.isSubmit=!0,c.A.post("/animal",this.dialogForm).then((e=>{0==e.code?(this.$message({showClose:!0,message:"添加成功",type:"success"}),this.dialogVisible=!1,this.fetchData()):this.$message({showClose:!0,message:e.msg,type:"error"}),this.isSubmit=!1})).catch((()=>{this.isSubmit=!1})),!0):(this.isSubmit=!1,!1)))},handleDelete(e,t){this.$confirm("此操作将删除选中数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{c.A.delete("/animal/"+t.id).then((e=>{0==e.code?(this.$message({type:"success",message:"删除成功!"}),this.onReset()):this.$message({type:"success",errpr:"删除失败!"})}))})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},batchDelete(){this.multipleSelection.length<1?this.$message({message:"请先选择要删除的数据！",type:"warning"}):c.A.delete(`/animal/deleteBatch?ids=${this.multipleSelection.join(",")}`).then((e=>{"0"===e.code?(this.$message({showClose:!0,message:"批量删除成功",type:"success"}),this.onReset()):this.$message({showClose:!0,message:e.msg,type:"error"})}))},fetchData(){this.listLoading=!0,console.log("page:"+this.listQuery.currentPage),c.A.get("/animal/page",{params:{name:this.listQuery.name,pageNum:this.listQuery.currentPage,size:this.listQuery.pageSize}}).then((e=>{const t=e.data;"0"===e.code&&(this.total=t.total,this.tableData=t.records)})),this.listLoading=!1},onSubmit(){this.listQuery.currentPage=1,this.fetchData()},onReset(){this.listQuery.currentPage=1,this.listQuery.pageSize=10,this.listQuery.name="",this.fetchData()},handleEditSave(e){this.$refs[e].validate((e=>{e?(this.isSubmit=!0,c.A.put("/animal/"+this.dialogForm.id,this.dialogForm).then((e=>{0==e.code?(this.$message({showClose:!0,message:"更新成功",type:"success"}),this.dialogVisible=!1,this.fetchData()):this.$message({showClose:!0,message:"更新失败",type:"error"}),this.isSubmit=!1})).catch((()=>{this.isSubmit=!1}))):this.isSubmit=!1}))},exportTable(e){if(this.tableData.length){const t={header:["宠物头像","宠物名字","宠物种类","宠物性别","宠物年龄","宠物状态","宠物品种","宠物介绍"],key:["img","name","type","sex","age","status","breed","descr"],data:this.tableData.map((e=>({img:e.img,name:e.name,type:e.type,sex:e.sex,age:`${e.age}岁`,status:e.status,breed:e.breed,descr:e.descr}))),autoWidth:!0,fileName:"宠物信息表",bookType:e};s.Ay.exportDataToExcel(t),this.exportVisible=!1}}}},m=d,g=a(1656),u=(0,g.A)(m,l,i,!1,null,null,null),p=u.exports}}]);
//# sourceMappingURL=589.0cfcf630.js.map