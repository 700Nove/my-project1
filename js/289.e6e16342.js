"use strict";(self["webpackChunkpet"]=self["webpackChunkpet"]||[]).push([[289],{7289:function(t,e,i){i.r(e),i.d(e,{default:function(){return p}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"category-wrapper"},[e("el-card",{attrs:{shadow:"always"}},[e("div",{staticClass:"control-btns"},[e("el-button",{staticStyle:{float:"right","margin-right":"10px","background-color":"blue","border-color":"blue"},attrs:{type:"primary",size:"medium"},on:{click:function(e){t.exportVisible=!0}}},[t._v("导出数据")])],1),e("el-form",{ref:"searchForm",staticClass:"search-form",attrs:{inline:!0,model:t.listQuery,"label-width":"90px"}},[e("el-form-item",{attrs:{label:"宠物名字"}},[e("el-input",{attrs:{placeholder:"请输入宠物名字"},model:{value:t.listQuery.name,callback:function(e){t.$set(t.listQuery,"name",e)},expression:"listQuery.name"}})],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("查询")])],1),e("el-form-item",[e("el-button",{attrs:{type:"danger"},on:{click:t.onReset}},[t._v("重置")])],1)],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],ref:"multipleTable",attrs:{data:t.tableData},on:{"selection-change":t.handleSelectionChange}},[e("el-table-column",{attrs:{prop:"id",label:"序号",width:"50",align:"center",sortable:""}}),e("el-table-column",{attrs:{prop:"img",label:"上报图片"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-button",{attrs:{plain:"",type:"success",size:"mini"},on:{click:function(e){return t.showImgDialog(i.$index,i.row)}}},[t._v(" 查看上报图片 ")])]}}])}),e("el-table-column",{attrs:{prop:"name",label:"上报说明","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"time",label:"上报时间"}}),e("el-table-column",{attrs:{prop:"status",label:"处理状态"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-tag",{attrs:{size:"small",type:"已处理"===i.row.status?"success":"warning"}},[t._v(" "+t._s(i.row.status)+" ")])]}}])}),e("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(i){return["待处理"===i.row.status?e("el-button",{attrs:{plain:"",size:"mini",type:"primary"},on:{click:function(e){return t.handleDeal(i.$index,i.row)}}},[t._v("去处理")]):t._e(),"USER"==t.userInfo.role&&"待处理"===i.row.status?e("el-button",{attrs:{size:"mini"},on:{click:function(e){return t.handleEdit(i.$index,i.row)}}},[t._v("编辑")]):t._e(),"USER"!=t.userInfo.role&&"已处理"===i.row.status?e("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(e){return t.handleDelete(i.$index,i.row)}}},[t._v("删除")]):t._e()]}}])})],1),e("Pagination",{attrs:{total:t.total,page:t.listQuery.currentPage,limit:t.listQuery.pageSize},on:{"update:page":function(e){return t.$set(t.listQuery,"currentPage",e)},"update:limit":function(e){return t.$set(t.listQuery,"pageSize",e)},pagination:t.fetchData}}),e("el-dialog",{staticClass:"dialog-form",attrs:{title:"修改上报信息",visible:t.formVisibleEdit,width:"50%","close-on-click-modal":!1,modal:!1},on:{"update:visible":function(e){t.formVisibleEdit=e}}},[e("el-form",{ref:"dialogForm",attrs:{model:t.dialogForm,rules:t.formRules,"label-width":"100px"}},[e("div",{staticStyle:{margin:"5px","text-align":"center"}},[e("el-upload",{attrs:{action:"#","list-type":"picture-card","on-preview":t.handlePreview,"on-remove":t.handleRemove,"on-change":t.handleChange,"file-list":t.fileList,limit:6,"on-exceed":t.handleExceed,"auto-upload":!1}},[e("i",{staticClass:"el-icon-plus"})])],1),e("el-form-item",{attrs:{prop:"name",label:"上报说明"}},[e("el-input",{attrs:{type:"textarea",rows:4,autocomplete:"off"},model:{value:t.dialogForm.name,callback:function(e){t.$set(t.dialogForm,"name",e)},expression:"dialogForm.name"}})],1),e("div",{staticClass:"footer-item"},[e("el-button",{on:{click:function(e){t.formVisibleEdit=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary",disabled:t.isSubmit},on:{click:function(e){return t.handleEditSave("dialogForm")}}},[t._v("确 定")])],1)],1)],1),e("el-dialog",{attrs:{title:"图片信息",visible:t.imgDialogVisible,width:"50%"},on:{"update:visible":function(e){t.imgDialogVisible=e}}},[0===t.imgsList.length?e("div",{staticStyle:{"text-align":"center",padding:"20px"}},[t._v(" 暂无信息 ")]):e("div",{staticClass:"img-list",staticStyle:{"text-align":"center",width:"100%",margin:"10px"}},t._l(t.fileList,(function(t,i){return e("img",{key:i,staticStyle:{width:"150px",height:"150px"},attrs:{src:t.url,alt:""}})})),0),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.closeImgDialog}},[t._v("关闭")])],1)]),e("el-dialog",{attrs:{title:"导出数据",visible:t.exportVisible,width:"500px"},on:{"update:visible":function(e){t.exportVisible=e}}},[e("div",{staticClass:"export-data",staticStyle:{display:"flex","flex-direction":"row","justify-content":"space-between"}},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.exportTable("xlsx")}}},[t._v("EXCEL格式")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.exportTable("csv")}}},[t._v("CSV格式")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.exportTable("txt")}}},[t._v("TXT格式")])],1),e("div",{staticClass:"hints"},[t._v("TIP：请选择要导出数据的格式。")])])],1)],1)},a=[],l=(i(4114),i(186)),o=i(1184),n=i(1867),r=i(193),c=i(7120),u={inject:["userInfo"],name:"Submit",components:{Pagination:o.A,Upload:n.A,Hints:r.A},data(){return{uploadUrl:"/api/file/upload",imgBaseUrl:this.HOST,fileList:[],imgsList:[],listLoading:!0,listQuery:{name:void 0,currentPage:1,pageSize:10},dialogForm:{id:void 0,name:void 0},total:0,tableData:[],multipleSelection:[],deletedImgs:[],newImgs:[],formVisibleEdit:!1,imgDialogVisible:!1,categoryList:[],formRules:{name:[{required:!0,message:"请输入上报说明",trigger:"blur"}]},isSubmit:!1,filesFormat:".txt, .csv, .xls, .xlsx",exportVisible:!1}},created(){this.fetchData()},methods:{handlePreview(t){},handleRemove(t,e){this.fileList=e,this.deletedImgs.push(t.url)},handleChange(t,e){this.newImgs.push(t),this.fileList=e},handleExceed(){this.$message({type:"warning",message:"最多上传6张图片"})},handleSelectionChange(t){this.multipleSelection=t.map((t=>t.id))},showImgDialog(t,e){this.loadImgs(e.id),this.imgDialogVisible=!0},closeImgDialog(){this.imgDialogVisible=!1},handleDeal(t,e){c.A.put("/submit/updateStatus/"+e.id).then((t=>{0==t.code?(this.$message({message:"处理成功",type:"success"}),this.fetchData()):this.$message({message:t.msg,type:"error"})}))},handleEdit(t,e){this.fileList=[],this.dialogForm=JSON.parse(JSON.stringify(e)),this.loadImgs(e.id),this.formVisibleEdit=!0},handleDelete(t,e){this.$confirm("此操作将删除选中数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{c.A.delete("/submit/"+e.id).then((t=>{0==t.code?(this.$message({type:"success",message:"删除成功!"}),this.onReset(),this.fetchData()):this.$message({type:"success",errpr:"删除失败!"})}))})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},fetchData(){this.listLoading=!0,c.A.get("/submit/page",{params:{name:this.listQuery.name,currentPage:this.listQuery.currentPage,size:this.listQuery.pageSize}}).then((t=>{const e=t.data;"0"===t.code&&(this.total=e.total,this.tableData=e.records)})),this.listLoading=!1},onSubmit(){this.listQuery.currentPage=1,this.fetchData()},onReset(){this.listQuery.currentPage=1,this.listQuery.pageSize=10,this.listQuery.name="",this.fetchData()},loadImgs(t){var e=[];c.A.get("/submitImg/"+t).then((t=>{0==t.code&&(e=t.data,e&&(this.imgsList=e.map((t=>{this.imgBaseUrl,t.url})),this.fileList=e.map((t=>(t.url=this.imgBaseUrl+"/img/"+t.url,t)))))}))},handleEditSave(t){this.$refs[t].validate((t=>{if(t){const t=new FormData;this.newImgs.forEach((e=>{t.append("files[]",e.raw)})),t.append("deletedImgs",JSON.stringify(this.deletedImgs));const e=JSON.stringify(this.dialogForm);t.append("submit",e),c.A.post("/submit/update",t).then((t=>{0==t.code?(this.$message({showClose:!0,message:"更新成功",type:"success"}),this.deletedImgs=[],this.newImgs=[],this.fileList=[],this.formVisibleEdit=!1,this.fetchData()):this.$message({showClose:!0,message:"更新失败",type:"error"})}))}}))},exportTable(t){if(this.tableData.length){const e={header:["序号","上报图片","上报说明","上报时间","处理状态"],key:["id","img","name","time","status"],data:this.tableData,autoWidth:!0,fileName:"上报信息表",bookType:t};l.Ay.exportDataToExcel(e),this.exportVisible=!1}}}},m=u,d=i(1656),g=(0,d.A)(m,s,a,!1,null,null,null),p=g.exports}}]);
//# sourceMappingURL=289.e6e16342.js.map