"use strict";(self["webpackChunkpet"]=self["webpackChunkpet"]||[]).push([[986],{1986:function(t,e,i){i.r(e),i.d(e,{default:function(){return m}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"notification-wrapper"},[e("el-card",{attrs:{shadow:"always"}},[e("div",{staticClass:"control-btns"},[e("el-button",{attrs:{type:"primary"},on:{click:t.handleSendNotification}},[t._v("发送通知")]),e("el-button",{attrs:{type:"danger"},on:{click:t.batchDelete}},[t._v("批量删除")])],1),e("el-form",{ref:"searchForm",staticClass:"search-form",attrs:{inline:!0,model:t.listQuery,"label-width":"80px"}},[e("el-form-item",{attrs:{label:"用户名"}},[e("el-input",{attrs:{placeholder:"用户名"},model:{value:t.listQuery.username,callback:function(e){t.$set(t.listQuery,"username",e)},expression:"listQuery.username"}})],1),e("el-form-item",{attrs:{label:"状态"}},[e("el-select",{attrs:{placeholder:"请选择状态"},model:{value:t.listQuery.status,callback:function(e){t.$set(t.listQuery,"status",e)},expression:"listQuery.status"}},[e("el-option",{attrs:{label:"未读",value:"unread"}}),e("el-option",{attrs:{label:"已读",value:"read"}})],1)],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("查询")]),e("el-button",{on:{click:t.onReset}},[t._v("重置")])],1)],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData},on:{"selection-change":t.handleSelectionChange}},[e("el-table-column",{attrs:{type:"selection",width:"55"}}),e("el-table-column",{attrs:{prop:"username",label:"用户名"}}),e("el-table-column",{attrs:{prop:"message",label:"消息内容","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"timestamp",label:"发送时间",width:"180"}}),e("el-table-column",{attrs:{prop:"status",label:"状态",width:"100"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-tag",{attrs:{type:"unread"===i.row.status?"warning":"success"}},[t._v(" "+t._s("unread"===i.row.status?"未读":"已读")+" ")])]}}])}),e("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:t._u([{key:"default",fn:function(i){return["unread"===i.row.status?e("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.markAsRead(i.row)}}},[t._v("标记已读")]):t._e(),e("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.handleDelete(i.row)}}},[t._v("删除")])]}}])})],1),e("Pagination",{attrs:{total:t.total,page:t.listQuery.currentPage,limit:t.listQuery.size},on:{"update:page":function(e){return t.$set(t.listQuery,"currentPage",e)},"update:limit":function(e){return t.$set(t.listQuery,"size",e)},pagination:t.fetchData}}),e("el-dialog",{attrs:{title:"发送通知",visible:t.dialogVisible,width:"500px",modal:!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("el-form",{ref:"notificationForm",attrs:{model:t.notificationForm,rules:t.rules,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"发送对象",prop:"sendType"}},[e("el-radio-group",{on:{change:t.handleSendTypeChange},model:{value:t.notificationForm.sendType,callback:function(e){t.$set(t.notificationForm,"sendType",e)},expression:"notificationForm.sendType"}},[e("el-radio",{attrs:{label:"role"}},[t._v("按角色发送")]),e("el-radio",{attrs:{label:"user"}},[t._v("按用户发送")])],1)],1),"role"===t.notificationForm.sendType?e("el-form-item",{attrs:{label:"选择角色",prop:"role"}},[e("el-select",{attrs:{placeholder:"请选择角色"},model:{value:t.notificationForm.role,callback:function(e){t.$set(t.notificationForm,"role",e)},expression:"notificationForm.role"}},[e("el-option",{attrs:{label:"普通用户",value:"USER"}}),e("el-option",{attrs:{label:"管理员",value:"ADMIN"}})],1)],1):t._e(),"user"===t.notificationForm.sendType?e("el-form-item",{attrs:{label:"选择用户",prop:"userId"}},[e("el-select",{attrs:{placeholder:"请输入用户名搜索",filterable:"",remote:"","reserve-keyword":"","remote-method":t.remoteSearchUsers,loading:t.userLoading},model:{value:t.notificationForm.userId,callback:function(e){t.$set(t.notificationForm,"userId",e)},expression:"notificationForm.userId"}},t._l(t.userList,(function(i){return e("el-option",{key:i.id,attrs:{label:i.username,value:i.id}},[e("span",{staticStyle:{float:"left"}},[t._v(t._s(i.username))]),e("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[t._v(t._s(i.email))])])})),1)],1):t._e(),e("el-form-item",{attrs:{label:"消息内容",prop:"message"}},[e("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入消息内容"},model:{value:t.notificationForm.message,callback:function(e){t.$set(t.notificationForm,"message",e)},expression:"notificationForm.message"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.submitNotification}},[t._v("确 定")])],1)],1)],1)],1)},s=[],o=i(1184),n=i(7120),r={name:"NotificationManagement",components:{Pagination:o.A},data(){return{listLoading:!0,listQuery:{username:"",status:"",currentPage:1,size:10},total:0,tableData:[],multipleSelection:[],dialogVisible:!1,userList:[],userLoading:!1,userQuery:"",timeout:null,notificationForm:{sendType:"role",role:null,userId:null,message:""},rules:{sendType:[{required:!0,message:"请选择发送对象",trigger:"change"}],role:[{required:!0,message:"请选择角色",trigger:"change"}],userId:[{required:!0,message:"请选择用户",trigger:"change"}],message:[{required:!0,message:"请输入消息内容",trigger:"blur"}]}}},mounted(){this.fetchData()},methods:{formatDateTime(t){if(!t)return"";const e=new Date(t),i=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),o=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0"),r=String(e.getSeconds()).padStart(2,"0");return`${i}-${a}-${s} ${o}:${n}:${r}`},fetchData(){this.listLoading=!0,n.A.get("/pet-notification/page",{params:this.listQuery}).then((t=>{"0"===t.code&&t.data&&(this.total=t.data.total,this.tableData=(t.data.records||[]).map((t=>({...t,timestamp:this.formatDateTime(t.timestamp)})))),this.listLoading=!1})).catch((()=>{this.listLoading=!1}))},handleSendNotification(){this.dialogVisible=!0,this.notificationForm={sendType:"role",role:null,userId:null,message:""},this.userList=[]},submitNotification(){this.$refs.notificationForm.validate((t=>{if(t){const t="role"===this.notificationForm.sendType?`/pet-notification/role/${this.notificationForm.role}`:`/pet-notification/user/${this.notificationForm.userId}`;n.A.post(t,{message:this.notificationForm.message}).then((t=>{"0"===t.code?(this.$message.success("发送成功"),this.dialogVisible=!1,this.fetchData()):this.$message.error(t.message||"发送失败")}))}}))},handleSelectionChange(t){this.multipleSelection=t.map((t=>t.id))},markAsRead(t){n.A.put(`/pet-notification/markAsRead/${t.id}`).then((t=>{"0"===t.code&&(this.$message.success("标记成功"),this.fetchData())}))},handleDelete(t){this.$confirm("确认删除该通知?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{n.A.delete(`/pet-notification/${t.id}`).then((t=>{"0"===t.code&&(this.$message.success("删除成功"),this.fetchData())}))}))},batchDelete(){0!==this.multipleSelection.length?this.$confirm("确认删除选中的通知?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{n.A.delete(`/pet-notification/deleteBatch?ids=${this.multipleSelection.join(",")}`).then((t=>{"0"===t.code&&(this.$message.success("批量删除成功"),this.fetchData())}))})):this.$message.warning("请选择要删除的记录")},onSubmit(){this.listQuery.currentPage=1,this.fetchData()},onReset(){this.listQuery={username:"",status:"",currentPage:1,size:10},this.fetchData()},remoteSearchUsers(t){""!==t?(this.userLoading=!0,clearTimeout(this.timeout),this.timeout=setTimeout((()=>{n.A.get("/user/search",{params:{username:t,limit:10}}).then((t=>{this.userLoading=!1,"0"===t.code&&(this.userList=t.data||[])})).catch((()=>{this.userLoading=!1}))}),300)):this.userList=[]},handleSendTypeChange(){this.notificationForm.userId=null,this.notificationForm.role=null,this.userList=[]}}},l=r,u=i(1656),c=(0,u.A)(l,a,s,!1,null,null,null),m=c.exports}}]);
//# sourceMappingURL=986.feb04bcf.js.map