"use strict";(self["webpackChunkpet"]=self["webpackChunkpet"]||[]).push([[350],{3350:function(e,t,i){i.r(t),i.d(t,{default:function(){return g}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"goods-wrapper"},[t("el-card",{staticClass:"main-card",attrs:{shadow:"hover"}},[t("div",{staticClass:"action-bar"},[t("div",{staticClass:"left-actions"},[t("el-popconfirm",{attrs:{title:"确认删除?"},on:{confirm:e.batchDelete},scopedSlots:e._u([{key:"reference",fn:function(){return[t("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"medium"}},[e._v("批量删除")])]},proxy:!0}])})],1),t("div",{staticClass:"right-actions"},[t("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"medium"},on:{click:e.handleCreate}},[e._v("添加商品")]),t("el-button",{attrs:{type:"success",icon:"el-icon-download",size:"medium"},on:{click:function(t){e.exportVisible=!0}}},[e._v("导出数据")])],1)]),t("el-form",{ref:"searchForm",staticClass:"search-form",attrs:{inline:!0,model:e.listQuery,"label-width":"90px"}},[t("el-form-item",{attrs:{label:"商品名称"}},[t("el-input",{attrs:{placeholder:"请输入商品名称","prefix-icon":"el-icon-goods"},model:{value:e.listQuery.name,callback:function(t){e.$set(e.listQuery,"name",t)},expression:"listQuery.name"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.onSubmit}},[e._v("查询")]),t("el-button",{attrs:{icon:"el-icon-refresh"},on:{click:e.onReset}},[e._v("重置")])],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"multipleTable",staticClass:"goods-table",attrs:{data:e.tableData,border:"",stripe:""},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"60",align:"center"}}),t("el-table-column",{attrs:{prop:"id",label:"编号",width:"80",sortable:"",align:"center"}}),t("el-table-column",{attrs:{prop:"name",label:"商品名称","min-width":"150","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"price",label:"商品价格",width:"100",align:"center"}}),t("el-table-column",{attrs:{prop:"img",label:"商品图片",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-image",{staticClass:"product-image",attrs:{src:e.imgBaseUrl+"/"+i.row.img,alt:"商品图片","preview-src-list":[e.imgBaseUrl+"/"+i.row.img]}})]}}])}),t("el-table-column",{attrs:{prop:"num",label:"剩余数量",width:"100",align:"center"}}),t("el-table-column",{attrs:{prop:"desrc",label:"商品描述","min-width":"200","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"操作",width:"180",align:"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-edit"},on:{click:function(t){return e.handleEdit(i.$index,i.row)}}},[e._v("编辑")]),"SUPER_ADMIN"!==i.row.role?t("el-button",{staticClass:"delete-btn",attrs:{type:"text",size:"small",icon:"el-icon-delete"},on:{click:function(t){return e.handleDelete(i.$index,i.row)}}},[e._v("删除")]):e._e()]}}])})],1),t("div",{staticClass:"pagination-container"},[t("Pagination",{attrs:{total:e.total,page:e.listQuery.currentPage,limit:e.listQuery.pageSize},on:{"update:page":function(t){return e.$set(e.listQuery,"currentPage",t)},"update:limit":function(t){return e.$set(e.listQuery,"pageSize",t)},pagination:e.fetchData}})],1),t("el-dialog",{staticClass:"dialog-form",attrs:{title:"添加商品",visible:e.formVisibleAdd,width:"500px",modal:!1},on:{"update:visible":function(t){e.formVisibleAdd=t}}},[t("el-form",{ref:"dialogForm",attrs:{model:e.dialogForm,rules:e.formRules,"label-width":"100px"}},[t("div",{staticClass:"avatar-upload"},[t("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.uploadUrl,"show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[e.dialogForm.img?t("el-image",{staticClass:"avatar",attrs:{src:e.imgBaseUrl+"/"+e.dialogForm.img}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})],1),t("div",{staticClass:"upload-tip"},[e._v("点击上传商品图片")])],1),t("el-form-item",{attrs:{prop:"name",label:"商品名称"}},[t("el-input",{attrs:{placeholder:"请输入商品名称"},model:{value:e.dialogForm.name,callback:function(t){e.$set(e.dialogForm,"name",t)},expression:"dialogForm.name"}})],1),t("el-form-item",{attrs:{prop:"price",label:"商品价格"}},[t("el-input",{attrs:{placeholder:"请输入商品价格"},on:{input:function(t){return e.handleInput("num")}},model:{value:e.dialogForm.price,callback:function(t){e.$set(e.dialogForm,"price",t)},expression:"dialogForm.price"}})],1),t("el-form-item",{attrs:{prop:"num",label:"剩余数量"}},[t("el-input",{attrs:{placeholder:"请输入商品数量"},on:{input:function(t){return e.handleInput("num")}},model:{value:e.dialogForm.num,callback:function(t){e.$set(e.dialogForm,"num",e._n(t))},expression:"dialogForm.num"}})],1),t("el-form-item",{attrs:{prop:"desrc",label:"商品描述"}},[t("el-input",{attrs:{resize:"false",type:"textarea",rows:4,placeholder:"请输入商品描述"},model:{value:e.dialogForm.desrc,callback:function(t){e.$set(e.dialogForm,"desrc",t)},expression:"dialogForm.desrc"}})],1),t("div",{staticClass:"dialog-footer"},[t("el-button",{on:{click:function(t){e.formVisibleAdd=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary",disabled:e.isSubmit},on:{click:function(t){return e.handleAdd("dialogForm")}}},[e._v("确定")])],1)],1)],1),t("el-dialog",{staticClass:"dialog-form",attrs:{title:"修改商品信息",visible:e.formVisibleEdit,width:"500px"},on:{"update:visible":function(t){e.formVisibleEdit=t}}},[t("el-form",{ref:"dialogForm",attrs:{model:e.dialogForm,rules:e.formRules,"label-width":"100px"}},[t("div",{staticClass:"avatar-upload"},[t("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.uploadUrl,"show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[e.dialogForm.img?t("el-image",{staticClass:"avatar",attrs:{src:e.imgBaseUrl+"/"+e.dialogForm.img}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})],1),t("div",{staticClass:"upload-tip"},[e._v("点击上传商品图片")])],1),t("el-form-item",{attrs:{prop:"name",label:"商品名称"}},[t("el-input",{attrs:{placeholder:"请输入商品名称"},model:{value:e.dialogForm.name,callback:function(t){e.$set(e.dialogForm,"name",t)},expression:"dialogForm.name"}})],1),t("el-form-item",{attrs:{prop:"price",label:"商品价格"}},[t("el-input",{attrs:{placeholder:"请输入商品价格"},on:{input:function(t){return e.handleInput("num")}},model:{value:e.dialogForm.price,callback:function(t){e.$set(e.dialogForm,"price",t)},expression:"dialogForm.price"}})],1),t("el-form-item",{attrs:{prop:"num",label:"剩余数量"}},[t("el-input",{attrs:{min:"0",placeholder:"请输入商品数量"},on:{input:function(t){return e.handleInput("num")}},model:{value:e.dialogForm.num,callback:function(t){e.$set(e.dialogForm,"num",e._n(t))},expression:"dialogForm.num"}})],1),t("el-form-item",{attrs:{prop:"desrc",label:"商品描述"}},[t("el-input",{attrs:{resize:"false",type:"textarea",rows:4,placeholder:"请输入商品描述"},model:{value:e.dialogForm.desrc,callback:function(t){e.$set(e.dialogForm,"desrc",t)},expression:"dialogForm.desrc"}})],1),t("div",{staticClass:"dialog-footer"},[t("el-button",{on:{click:function(t){e.formVisibleEdit=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary",disabled:e.isSubmit},on:{click:function(t){return e.handleEditSave("dialogForm")}}},[e._v("确定")])],1)],1)],1),t("el-dialog",{staticClass:"export-dialog",attrs:{title:"导出数据",visible:e.exportVisible,width:"500px"},on:{"update:visible":function(t){e.exportVisible=t}}},[t("div",{staticClass:"export-options"},[t("el-button",{attrs:{type:"primary",icon:"el-icon-document"},on:{click:function(t){return e.exportTable("xlsx")}}},[e._v("EXCEL格式")]),t("el-button",{attrs:{type:"success",icon:"el-icon-document"},on:{click:function(t){return e.exportTable("csv")}}},[e._v("CSV格式")]),t("el-button",{attrs:{type:"info",icon:"el-icon-document"},on:{click:function(t){return e.exportTable("txt")}}},[e._v("TXT格式")])],1),t("div",{staticClass:"export-tip"},[e._v("请选择要导出数据的格式")])])],1)],1)},l=[],s=i(186),o=i(1184),r=i(1867),n=i(193),c=i(7120),d={inject:["userInfo"],name:"UserManager",components:{Pagination:o.A,Upload:r.A,Hints:n.A},data(){return{uploadUrl:"/api/file/upload",imgBaseUrl:this.HOST,listLoading:!0,listQuery:{name:void 0,currentPage:1,pageSize:10},dialogForm:{name:void 0,price:void 0,num:void 0,desrc:void 0,img:void 0},total:0,tableData:[],multipleSelection:[],formVisible:!1,formVisibleAdd:!1,formVisibleEdit:!1,categoryList:[],formRules:{name:[{required:!0,message:"请输入商品名称",trigger:"blur"}],price:[{required:!0,message:"请输入商品价格",trigger:"blur"},{validator:this.validatePrice,trigger:"blur"}],num:[{required:!0,message:"请输入商品数量",trigger:"blur"},{type:"number",message:"商品数量必须为数字",trigger:"blur"}],desrc:[{required:!0,message:"请输入商品描述",trigger:"blur"}]},isSubmit:!1,filesFormat:".txt, .csv, .xls, .xlsx",exportVisible:!1}},created(){this.fetchData()},methods:{validatePrice(e,t,i){!t||isNaN(t)||t<0?i(new Error("商品价格必须为非负数且为有效数字")):i()},handleInput(e){this.dialogForm[e]<0&&(this.dialogForm[e]=0)},handleAvatarSuccess(e,t){this.dialogForm.img=e.data},beforeAvatarUpload(e){const t=e.type.match("image/jpeg|image/png"),i=e.size/1024/1024<2;return t||this.$message.error("上传头像图片只能是 JPG 或 PNG 格式!"),i||this.$message.error("上传头像图片大小不能超过 2MB!"),t&&i},onUploadSuccess(e){this.dialogForm.img=e.data},getCompleteImgUrl(e){return this.HOST+e},handleSelectionChange(e){this.multipleSelection=e.map((e=>e.id))},handleCreate(){this.formVisibleAdd=!0,this.dialogForm={}},handleEdit(e,t){this.dialogForm=JSON.parse(JSON.stringify(t)),this.formVisibleEdit=!0},handleAdd(e){this.$refs[e].validate((e=>e?(c.A.post("/goods",this.dialogForm).then((e=>{0==e.code?(this.$message({showClose:!0,message:"商品添加成功",type:"success"}),this.fetchData()):this.$message({showClose:!0,message:e.msg,type:"error"})})),this.formVisibleAdd=!1,!0):(this.isSubmit=!1,!1)))},handleDelete(e,t){this.$confirm("此操作将删除选中数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{c.A.delete("/goods/"+t.id).then((e=>{0==e.code?(this.$message({type:"success",message:"删除成功!"}),this.onReset()):this.$message({type:"success",error:"删除失败!"})}))})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},batchDelete(){this.multipleSelection.length<1?this.$message({message:"请先选择要删除的数据！",type:"warning"}):c.A.delete(`/goods/deleteBatch?ids=${this.multipleSelection.join(",")}`).then((e=>{"0"===e.code?(this.$message({showClose:!0,message:"批量删除成功",type:"success"}),this.onReset()):this.$message({showClose:!0,message:e.msg,type:"error"})}))},fetchData(){this.listLoading=!0,c.A.get("/goods/page",{params:{name:this.listQuery.name,currentPage:this.listQuery.currentPage,size:this.listQuery.pageSize}}).then((e=>{const t=e.data;"0"===e.code&&(this.total=t.total,this.tableData=t.records)})),this.listLoading=!1},onSubmit(){this.listQuery.currentPage=1,this.fetchData()},onReset(){this.listQuery.currentPage=1,this.listQuery.pageSize=10,this.listQuery.name="",this.fetchData()},handleEditSave(e){this.$refs[e].validate((e=>{e&&c.A.put("/goods/"+this.dialogForm.id,this.dialogForm).then((e=>{0==e.code?(this.$message({showClose:!0,message:"更新成功",type:"success"}),this.formVisibleEdit=!1,this.fetchData()):this.$message({showClose:!0,message:"更新失败",type:"error"})}))}))},exportTable(e){if(this.tableData.length){const t={header:["编号","商品名称","商品价格","商品图片","剩余数量","商品描述"],key:["id","name","price","img","num","desrc"],data:this.tableData,autoWidth:!0,fileName:"商品信息表",bookType:e};s.Ay.exportDataToExcel(t),this.exportVisible=!1}}}},m=d,u=i(1656),p=(0,u.A)(m,a,l,!1,null,null,null),g=p.exports}}]);
//# sourceMappingURL=350.2f065d3e.js.map